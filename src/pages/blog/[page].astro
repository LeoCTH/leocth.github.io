---
import PostEmbed from "@components/PostEmbed.astro";
import Default from "@layouts/Default.astro";
//@ts-ignore
import { sortByDescending } from "@util/Util";

export async function getStaticPaths({ paginate }) {
  const allPosts = await Astro.glob("./*.md");
  sortByDescending(allPosts, (post) => new Date(post.frontmatter.date));

  return paginate(allPosts, { pageSize: 5 });
}

const { page } = Astro.props;
const previousPage = page.currentPage - 1;
const nextPage = page.currentPage + 1;
const onFirstPage = previousPage <= 0;
const onLastPage = nextPage > page.lastPage;
---

<Default title={`Blog (${page.currentPage}/${page.total})`}>
  <h1>Blog</h1>

  <div id="posts" class="content container my-5">
    {page.data.map((post) => <PostEmbed {post} />)}
  </div>

  <nav class="pagination is-centered" role="navigation" aria-label="pagination">
    <a
      class="pagination-previous"
      {/*@ts-ignore*/}
      disabled={onFirstPage}
      href={!onFirstPage && "/blog/1"}
    >
      <span class="icon"><i class={`fas fa-angles-left`}></i></span>
      <span class="is-hidden-mobile">First</span>
    </a>

    <a
      class="pagination-previous"
      {/*@ts-ignore*/}
      disabled={onFirstPage}
      href={!onFirstPage && `/blog/${previousPage}`}
    >
      <span class="icon"><i class={`fas fa-angle-left`}></i></span>
      <span class="is-hidden-mobile">Prev</span>
    </a>

    <ul class="pagination-list">
      {
        !onFirstPage && (
          <li>
            <a
              class="pagination-link"
              href={`/blog/${previousPage}`}
              aria-label={`Goto page
                ${previousPage}`}
            >
              {previousPage}
            </a>
          </li>
        )
      }

      <li>
        <a
          class="pagination-link is-current"
          aria-label={`Page ${page.currentPage}`}
          >{page.currentPage}
        </a>
      </li>

      {
        !onLastPage && (
          <li>
            <a
              class="pagination-link"
              href={`/blog/${nextPage}`}
              aria-label={`Goto page
                ${nextPage}`}
            >
              {nextPage}
            </a>
          </li>
        )
      }
    </ul>

    <a
      class="pagination-next"
      {/*@ts-ignore*/}
      disabled={onLastPage}
      href={!onLastPage && `/blog/${page.lastPage}`}
    >
      <span class="icon"><i class={`fas fa-angle-right`}></i></span>
      <span class="is-hidden-mobile">Next</span>
    </a>

    <a
      class="pagination-next"
      {/*@ts-ignore*/}
      disabled={onLastPage}
      href={!onLastPage && `/blog/${nextPage}`}
    >
      <span class="icon"><i class={`fas fa-angles-right`}></i></span>
      <span class="is-hidden-mobile">Last</span>
    </a>
  </nav>
</Default>
